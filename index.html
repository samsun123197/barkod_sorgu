<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Barkod Sorgulama Detay - GitHub Pages</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <style>
        /* Bu sayfaya özel stil ayarlarınızı buraya ekleyin */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background-color: #f4f7f6;
        }
        h1 {
            color: #dc3545; /* Veya barkod sayfanızın ana rengi */
            border-bottom: 2px solid #dc3545;
            padding-bottom: 10px;
        }
        /* ... Diğer CSS stilleri buraya gelir ... */
        input[type="text"], button {
            padding: 10px;
            border-radius: 5px;
            margin-right: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        button {
            background-color: #dc3545; /* Kırmızımsı bir ton kullandım */
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #c82333;
        }
        #yukleniyor { 
            color: orange; 
            font-style: italic; 
        }
        .hata { 
            color: red; 
            font-weight: bold;
        }
        /* ... */
    </style>
</head>
<body>
    <h1>Barkod Detay Sorgulama</h1>
    
    <label for="musteriKodu">Müşteri Kodu/Barkod Girin:</label>
    <input type="text" id="musteriKodu" placeholder="Müşteri Kodu veya Barkod" onkeypress="if(event.keyCode == 13) sorgula()">
    <button onclick="sorgula()">Sorgula</button>

    <p id="yukleniyor">Veriler Google Sheets'ten yükleniyor, lütfen bekleyiniz...</p>

    <hr>

    <h2>Sorgu Sonucu</h2>
    <div id="sonucAlani"></div>

    <script>
        // LÜTFEN BU URL'Yİ BARKOD SORGULAMA SAYFANIZIN GERÇEK VERİ KAYNAĞI İLE DEĞİŞTİRİN!
        const veriDosyasiURL = 'https://docs.google.com/sheets/d/e/2PACX-1vRkONEBGWF-u3K_tU6kNvsHUpO9LUx_ZDUCvy_SCCcjWh0K7jnmGeynwM9XAUwwww/pub?output=csv'; 
        let tumMusteriler = [];
        // ... (Barkod sorgulama sayfanızdaki diğer global değişkenler buraya gelir) ...
        
        // URL'den parametre okuma yardımcı fonksiyonu
        function getQueryParameter(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
            const results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        // 1. CSV dosyasını okuma ve belleğe yükleme
        Papa.parse(veriDosyasiURL, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                tumMusteriler = results.data;
                document.getElementById('yukleniyor').style.display = 'none';
                
                // ✨ ÇÖZÜM: Veri Yükleme Tamamlandı. Şimdi URL'yi kontrol et ve sorgula. ✨
                const musteriKodu = getQueryParameter('query'); 
                const musteriKoduInput = document.getElementById('musteriKodu');

                if (musteriKodu && musteriKoduInput) {
                    // Müşteri kodunu arama kutusuna yaz
                    musteriKoduInput.value = musteriKodu;
                    
                    // Veri hazır olduğu için sorgula fonksiyonunu çağır
                    if (typeof sorgula === 'function') {
                        sorgula(); 
                    }
                } else {
                    document.getElementById('sonucAlani').innerHTML = 'Veriler başarıyla yüklendi. Şimdi sorgulama yapabilirsiniz.';
                }
            },
            error: function(err, file) {
                document.getElementById('yukleniyor').innerHTML = `<p class="hata">Veri yüklenirken bir hata oluştu: ${err}</p>`;
            }
        });

        // LÜTFEN BU FONKSİYONU BARKOD SORGULAMA SAYFANIZIN GERÇEK İÇERİĞİ İLE DEĞİŞTİRİN!
        function sorgula() {
            const aramaMetni = document.getElementById('musteriKodu').value.trim().toUpperCase();
            const sonucDiv = document.getElementById('sonucAlani');
            
            if (aramaMetni === "") {
                sonucDiv.innerHTML = `<p class="hata">Lütfen bir değer girin.</p>`;
                return;
            }

            sonucDiv.innerHTML = `"${aramaMetni}" aranıyor...`;
            
            // Örneğin: Barkod veya Müşteri Kodu ile eşleşen veriyi bulma mantığı
            const sonuc = tumMusteriler.find(m => String(m['Müşteri Kodu']).trim().toUpperCase() === aramaMetni || String(m['Barkod']).trim().toUpperCase() === aramaMetni);

            if (sonuc) {
                // Detay tablosunu oluşturun
                let html = '<table>...</table>'; 
                sonucDiv.innerHTML = html;
            } else {
                sonucDiv.innerHTML = `<p class="hata"><strong>Hata:</strong> "${aramaMetni}" ile eşleşen kayıt bulunamadı.</p>`;
            }
        }
    </script>
</body>
</html>
